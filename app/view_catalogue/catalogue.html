<div ng-cloak ng-controller="StoreController as store">
<md-content class="md-padding" layout="row" layout-wrap layout-align="center start" layout-xs="column" ng-repeat="line in store.products | groupBy: 2">
<div flex="50" flex-sm="100" flex-xs="100" layout="column" ng-repeat="product in line" ng-hide="product.soldOut" >
		<md-card>
			<md-card-header class="product-card">
			<md-card-header-text>
			<div>{{product.name}}
				<em class="pull-right md-accent">{{product.price | currency}}</em>
			</div>
			</md-card-header-text>
			</md-card-header>
			<md-card-content>
			<md-button aria-label="cart" class="md-fab md-accent button-buy" ng-show="product.canPurchase">
				<ng-md-icon icon="add_shopping_cart" style="fill:white"></ng-md-icon>
			</md-button>
				<div class="gallery" ng-show="product.images.length" ng-controller="GalleryController as gallery">
					<img class="img img-circle img-thumbnail center-block" width="200px" ng-src="{{product.images[gallery.current]}}" />
					<div class="clearfix">
						<div class="img small-image pull-left thumbnail" ng-repeat="image in product.images">
							<img width="80px" ng-src="{{image}}" />			
						</div>
					</div>
				</div>
				<p>{{product.description}}</p>
				<section class="tab" ng-controller="TabController as tab">
					<div flex layout="row">
						<div>
							<md-button ng-class="{'md-primary':tab.isSet(1) }" aria-label="desc" ng-click='tab.setTab(1)'>Description</md-button>
						</div>
						<div>
							<md-button ng-class="{ 'md-primary':tab.isSet(2) }" aria-label="specs" ng-click='tab.setTab(2)'>Specs</md-button>
						</div>
						<div>
							<md-button ng-class="{'md-primary':tab.isSet(3) }" aria-label="revs" ng-click='tab.setTab(3)'>Reviews</md-button>
						</div>
					</div>
					<div ng-show='tab.isSet(1)'>
						<md-content flex layout-padding>
							<p>{{product.description}}</p>
						</md-content>
					</div>
					<div ng-show='tab.isSet(2)'>
						<md-content flex layout-padding>Shine: {{product.shine}}</md-content>
					</div>
					<div ng-show='tab.isSet(3)'>
						<md-content flex layout-padding>
						<blockquote ng-repeat="review in product.reviews">
							<strong>Stars: {{review.stars}}</strong>
							{{review.body}}
							<cite>- {{review.author}} on {{review.createdOn | date}}</cite>
						</blockquote>

						<form name="reviewForm" ng-controller="ReviewController as reviewCtrl" novalidate>
					        <blockquote ng-show="reviewCtrl.review.body">
				                 <strong>{{reviewCtrl.review.stars}} Stars</strong>
				                 {{reviewCtrl.review.body}}
	          					 <cite class="clearfix">-{{reviewCtrl.review.author}}</cite>
			                </blockquote>
		
							<h4>Submit a review</h4>

							<md-content style="align-items: center"class="md-padding" layout="column" layout-wrap layout-align="center start" layout-xs="column" >
							
									<fieldset class="form-group">
										<select ng-model="reviewCtrl.review.stars" required class="form-control" ng-options="stars for stars in [1,2,3,4,5]">
											<option value="" >Stars</option>								
										</select>
									</fieldset>
									<fieldset class="form-group">
										<textarea  ng-model="reviewCtrl.review.body" required class="form-control" placeholder="Write a short review" title="Review"></textarea>
									</fieldset>
									<fieldset class="form-group">
										<input ng-model="reviewCtrl.review.author" required  type="email" class="form-control" placeholder="you@email.com" title="Email"></input type="email">
									</fieldset>
		
									<fieldset class="form-group">
			                			<md-button aria-label="submit" class="md-raised md-primary submit-review" ng-click="reviewCtrl.addReview(product)" ng-disabled="!reviewForm.$valid" > 
			                				Post review
				                		</md-button>
					                </fieldset>
							</md-content>		                
		                </form>
						</md-content>
					</div>
				</section>
			</md-card-content>

		</md-card>
</div>
</md-content>
</div>
